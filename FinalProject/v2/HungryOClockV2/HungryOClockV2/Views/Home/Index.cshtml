@model HomeIndexVM
@{
	ViewBag.Title = "Hungry O'Clock";
}

<h2>Hungry O'Clock</h2>

@if(TempData["message"] != null)
{
	<div class="alert alert-success">@TempData["message"]</div>
}

<form asp-action="Index" method="get" class="row g-2 mb-4">
	<div class="col-md-5">
		<input asp-for="SearchTerm" class="form-control" placeholder="Search by restaurant name..." />
	</div>
	<div class="col-md-4">
		<select asp-for="CategoryId" asp-items="Model.Categories" class="form-select"></select>
	</div>
	<div class="col-md-3 d-flex">
		<button type="submit" class="btn btn-primary me-2">Search</button>
		<a asp-action="Index" class="btn btn-outline-secondary">Clear</a>
	</div>
</form>

@if (!Model.Restaurants.Any())
{
	<p><em>No restaurants found. Try a different search</em></p>
}
else
{
	<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
		@foreach(var r in Model.Restaurants)
		{
			var cats = r.RestaurantCategories
			.Select(rc => rc.Category?.Name)
			.Where(n => !string.IsNullOrEmpty(n));
			var catText = string.Join(", ", cats);

			string ratingText = r.AverageRating.HasValue ? $"{r.AverageRating.Value:F1} / 4" : "No ratings yet";
			<div class="col">
				<div class="card h-100">
					<div class="card-body d-flex flex-column">

						<h5 class="card-title">@r.Name</h5>

						<p class="card-text mb-1">
							<strong>Price:</strong> @(new string('$', r.PriceLevel))
						</p>

						<p class="card-text mb-1">
							<strong>Rating: </strong> @ratingText
						</p>

						<p class="card-text">
							<strong>Categories: </strong> @(string.IsNullOrEmpty(catText) ? "None" : catText)
						</p>

						<div class="mt-auto">
							<a asp-controller="Restaurant" asp-action="Details" asp-route-id="@r.RestaurantId" class="btn btn-primary me-2">View Details</a>
							@if(User.Identity?.IsAuthenticated ?? true)
							{
								<a asp-controller="Reservation" asp-action="Create" asp-route-restaurantId="@r.RestaurantId" class="btn btn-outline-success">Reserve a Table</a>
							}
						</div>
					</div>
				</div>
			</div>
		}
	</div>
}
